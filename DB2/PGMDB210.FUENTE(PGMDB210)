        CBL TEST                                                        00010099
       IDENTIFICATION DIVISION.                                         00020000
                                                                        00030019
        PROGRAM-ID PGMDB210.                                            00040099
      ****************************************************************  00050099
      *                                                              *  00060099
      *  PROGRAMA PARA SQL EMBEBIDO                                  *  00070099
      *                                                              *  00080099
      *                                                              *  00100099
      *                                                              *  00110099
      *                                                              *  00120099
      ****************************************************************  00130099
      *      MANTENIMIENTO DE PROGRAMA                         *        00140000
      **********************************************************        00150000
      *  FECHA  *    DETALLE        * COD *                             00160099
      *************************************                             00170099
      *5/3/2022 *                   *     *                             00180099
      *************************************                             00200099
       ENVIRONMENT DIVISION.                                            00210000
       CONFIGURATION SECTION.                                           00220000
       SPECIAL-NAMES.                                                   00230000
           DECIMAL-POINT IS COMMA.                                      00240000
                                                                        00250099
                                                                        00260099
       INPUT-OUTPUT SECTION.                                            00270000
       FILE-CONTROL.                                                    00280000
             SELECT IMPRIMIR     ASSIGN DDPRINT                         00290099
                    FILE STATUS  IS     WS-IMPR-CODE.                   00300099
       DATA DIVISION.                                                   00310000
       FILE SECTION.                                                    00320000
       FD IMPRIMIR                                                      00330099
            BLOCK CONTAINS 0 RECORDS                                    00340099
            RECORDING MODE IS F.                                        00350099
                                                                        00360099
       01 REG-IMPRIMIR       PIC X(132).                                00370099
                                                                        00380000
      **************************************                            00390000
       WORKING-STORAGE SECTION.                                         00400000
      **************************************                            00410007
       77 SQL-NOT-FOUND      PIC S9(03)       USAGE COMP-3 VALUE +100.  00420099
      * ESTADO DE PROCESO (FIN/NO FIN)                                  00430099
                                                                        00440099
       01  WS-BOOL-PROCESO   PIC X.                                     00450099
           88  WS-NO-FIN-PROCESO                            VALUE ' '.  00460099
           88  WS-FIN-PROCESO                               VALUE 'F'.  00470099
                                                                        00480000
      * FILE STATUS DE IMPRIMIR                                         00490099
       77 WS-IMPR-CODE       PIC XX                      VALUE ZEROES.  00500099
                                                                        00540099
                                                                        00560099
       77 WS-SQLCODE         PIC +++999    USAGE DISPLAY VALUE ZEROES.  00570099
                                                                        00580099
      * VARIABLE PARA CORTE DE CONTROL                                  00590099
                                                                        00600099
       77 WS-SUC-ANT         PIC 9(2)                    VALUE ZEROES.  00610099
       77 WS-TIPCUEN-ANT     PIC 9(2)                    VALUE ZEROES.  00620099
                                                                        00630099
       77 WS-CANT-CTAS-TOT   PIC 9(2)                    VALUE ZEROES.  00640099
       77 WS-SUB-SALDO-SUC   PIC S9(9)V9(2) USAGE COMP-3 VALUE ZEROES.  00650099
       77 WS-SUB-SALDO-TIPC  PIC S9(9)V9(2) USAGE COMP-3 VALUE ZEROES.  00660099
       77 WS-SUB-SALDO-TOTAL PIC S9(9)V9(2) USAGE COMP-3 VALUE ZEROES.  00670099
                                                                        00680099
       77 WS-SUB-SUCUEN      PIC S9(3)      USAGE COMP-3 VALUE ZEROES.  00690099
       77 WS-SUB-TIPCUEN     PIC S9(3)      USAGE COMP-3 VALUE ZEROES.  00700099
                                                                        00710099
      *             VARIABLES PARA IMPRESION *                          00720099
                                                                        00730099
      * TITULO                                                          00740099
                                                                        00750099
       01 WS-FECHA.                                                     00760099
           03 WS-ANIO        PIC 9(04)                   VALUE ZEROES.  00770099
           03 WS-MES         PIC 9(02)                   VALUE ZEROES.  00780099
           03 WS-DIA         PIC 9(02)                   VALUE ZEROES.  00790099
                                                                        00800099
       01 WS-IMPR-TITULO.                                               00810099
           03 WS-IMPR-DIA    PIC 9(02)                   VALUE ZEROES.  00820099
           03 FILLER         PIC X                       VALUE '-'.     00830099
           03 WS-IMPR-MES    PIC 9(02)                   VALUE ZEROES.  00840099
           03 FILLER         PIC X                       VALUE '-'.     00850099
           03 WS-IMPR-ANIO   PIC 9(04)                   VALUE ZEROES.  00860099
           03 FILLER         PIC X(05)                   VALUE SPACES.  00870099
           03 FILLER         PIC X(23)                   VALUE          00880099
                                               'CUENTAS POR CLIENTE '.  00890099
           03 FILLER         PIC X(05)                   VALUE SPACES.  00900099
           03 FILLER         PIC X(08)               VALUE 'PGMDB210'.  00910099
                                                                        00930099
      * SUBTITULO                                                       00940099
                                                                        00950099
      * TITULO 2. DATOS DEL CLIENTE                                     00960099
                                                                        00970099
       01 WS-IMPR-TITULO2.                                              00980099
           03 FILLER         PIC X(06)                 VALUE 'TIPDOC'.  00990099
           03 FILLER         PIC X(02)                   VALUE SPACES.  01000099
           03 FILLER         PIC X(06)                 VALUE 'NRODOC'.  01010099
           03 FILLER         PIC X(04)                   VALUE SPACES.  01020099
           03 FILLER         PIC X(06)                 VALUE 'NOMAPE'.  01030099
           03 FILLER         PIC X(06)                   VALUE SPACES.  01040099
           03 FILLER         PIC X(06)                 VALUE 'NROCLI'.  01050099
                                                                        01070099
      * REGISTRO CLIENTE -PARA TITULO 2                                 01080099
                                                                        01090099
       01 WS-LIS-REGISTRO-CLIENTE.                                      01100099
           03 WS-LIS-TIPDOC  PIC X(02)                   VALUE SPACES.  01110099
           03 FILLER         PIC X(03)                   VALUE SPACES.  01120099
           03 WS-LIS-NRODOC  PIC Z(10)9                  VALUE ZEROES.  01130099
           03 FILLER         PIC X                       VALUE SPACES.  01140099
           03 WS-LIS-NOMAPE  PIC X(11)                   VALUE SPACES.  01150099
           03 FILLER         PIC X(02)                   VALUE SPACES.  01160099
           03 WS-LIS-NROCLI  PIC Z(02)9                  VALUE ZEROES.  01170099
           03 FILLER         PIC X(66)                   VALUE SPACES.  01180099
                                                                        01190099
      * SUBTITULO DE CUENTAS                                            01220099
                                                                        01230099
       01 WS-IMPR-SUBTITULO.                                            01240099
           03 FILLER         PIC X(07)                VALUE 'TIPCUEN'.  01250099
           03 FILLER         PIC X(02)                   VALUE SPACES.  01260099
           03 FILLER         PIC X(07)                VALUE 'NROCUEN'.  01270099
           03 FILLER         PIC X(02)                   VALUE SPACES.  01280099
           03 FILLER         PIC X(06)                 VALUE 'SUCUEN'.  01290099
           03 FILLER         PIC X(02)                   VALUE SPACES.  01300099
           03 FILLER         PIC X(06)                 VALUE 'FECHA '.  01310099
           03 FILLER         PIC X(10)                   VALUE SPACES.  01320099
           03 FILLER         PIC X(05)                  VALUE 'SALDO'.  01330099
           03 FILLER         PIC X(85)                   VALUE SPACES.  01340099
                                                                        01350099
      * REGISTRO                                                        01360099
                                                                        01370099
      * WS-IMPR-REGISTRO DE SUBTITULO                                   01380099
                                                                        01381099
       01 WS-REG-CUENTA.                                                01390099
           03 FILLER             PIC X(05)               VALUE SPACES.  01400099
           03 WS-IMPR-TIPCUEN    PIC Z9                  VALUE ZEROES.  01410099
           03 FILLER             PIC X(04)               VALUE SPACES.  01420099
           03 WS-IMPR-NROCUEN    PIC ZZZZ9               VALUE ZEROES.  01430099
           03 FILLER             PIC X(05)               VALUE SPACES.  01440099
           03 WS-IMPR-SUCUEN     PIC ZZ9                 VALUE ZEROES.  01450099
           03 FILLER             PIC X(02)               VALUE SPACES.  01460099
           03 WS-IMPR-FECSAL     PIC X(10)               VALUE SPACES.  01470099
           03 FILLER             PIC X(02)               VALUE SPACES.  01480099
           03 WS-IMPR-SALDO      PIC -------9,99         VALUE ZEROES.  01490099
           03 FILLER             PIC X(85)               VALUE SPACES.  01500099
                                                                        01510099
                                                                        01520099
       01 WS-IMPR-SUBTOTALES-TIPCUEN.                                   01530099
           03 FILLER                PIC X(25)            VALUE          01540099
                                          'CANTIDAD DE CUENTAS TIPO '.  01550099
           03 WS-IMPR-TIPCUEN-SB    PIC X(18)            VALUE SPACES.  01570099
           03 FILLER                PIC X                VALUE SPACES.  01580099
           03 WS-IMPR-CANT-TIPCUEN  PIC ZZ9              VALUE ZEROES.  01600099
           03 FILLER                PIC X                VALUE SPACES.  01610099
           03 FILLER                PIC X(13)            VALUE          01620099
                                                      'TOTAL SALDOS:'.  01630099
           03 FILLER                PIC X(02)            VALUE SPACES.  01640099
           03 WS-IMPR-SALDOS-T      PIC ---------9,99    VALUE ZEROES.  01650099
                                                                        01670099
                                                                        01680099
       01 WS-IMPR-SUBTOTALES-SUCURSAL.                                  01690099
           03 FILLER                 PIC X(38)           VALUE          01700099
                             'CANTIDAD DE CUENTAS DE LA SUCURSAL N° '.  01710099
           03 WS-IMPR-SUCUEN-SUB     PIC 9               VALUE ZEROES.  01720099
           03 FILLER                 PIC XXX             VALUE ' : ' .  01730099
           03 WS-IMPR-CANT-CUENXSUC  PIC Z9              VALUE ZEROES.  01740099
           03 FILLER                 PIC X(02)           VALUE SPACES.  01760099
           03 FILLER                 PIC X(13)           VALUE          01770099
                                                      'TOTAL SALDOS:'.  01780099
           03 FILLER                 PIC X(07)           VALUE SPACES.  01790099
           03 WS-IMPR-SALDOS-S       PIC ---------9,99   VALUE ZEROES.  01800099
           03 FILLER                 PIC X(60)           VALUE SPACES.  01810099
                                                                        01820099
       01 WS-IMPR-TOTALES-GENERALES.                                    01830099
           03 FILLER                 PIC X(30)           VALUE          01840099
                                     'CANTIDAD DE CUENTAS DEL BANCO:'.  01850099
           03 FILLER                 PIC X(02)           VALUE SPACES.  01860099
           03 WS-IMPR-CANT-CUENXBCO  PIC X(02)           VALUE ZEROES.  01870099
           03 FILLER                 PIC X(02)           VALUE SPACES.  01880099
           03 FILLER                 PIC X(13)           VALUE          01890099
                                                      'TOTAL SALDOS:'.  01900099
           03 FILLER                 PIC X(07)           VALUE SPACES.  01910099
           03 WS-IMPR-SALDOS-G       PIC ---------9,99   VALUE ZEROES.  01920099
           03 FILLER                 PIC X(65)           VALUE SPACES.  01930099
                                                                        01940099
                                                                        01950099
      * LINEAS                                                          01960099
                                                                        01970099
       77 WS-CUENTA-LINEA            PIC 9(02)           VALUE ZEROES.  01980099
                                                                        01990099
       77 WS-LINEA-IMPRESION         PIC X(132)          VALUE SPACES.  02000099
                                                                        02010099
      * CONTADORES                                                      02090099
                                                                        02091099
       77  WS-NOV-LEIDAS         PIC 9(4)        VALUE ZEROES.          02100099
                                                                        02110099
       77  WS-NOV-INSERTADAS     PIC 9(4)        VALUE ZEROES.          02120099
                                                                        02130099
       77  WS-NOV-ERRONEAS       PIC 9(4)        VALUE ZEROES.          02140099
                                                                        02150099
       77  WS-REG-GRABADOS       PIC 9(4)        VALUE ZEROES.          02160099
                                                                        02170099
       77  TOTAL-EDIT            PIC ZZ9         VALUE ZEROES.          02180099
                                                                        02190056
      * VARIABLE PARA ALMACENAR EL NOMBRE COMPLETO *                    02200099
                                                                        02201099
       77  WS-NOMAPE-COMP        PIC X(30)       VALUE SPACES.          02210099
                                                                        02250002
      * DECLARO EL AREA DE COMUNICACIONES SQLCA                         02260024
            EXEC SQL                                                    02270002
              INCLUDE SQLCA                                             02280002
            END-EXEC.                                                   02290002
                                                                        02300041
      * INCLUDE DB2CUEN                                                 02310099
            EXEC SQL                                                    02320098
              INCLUDE DB2CUEN                                           02330099
            END-EXEC.                                                   02340098
                                                                        02350099
      * INCLUDE DB2CLIE                                                 02360099
           EXEC SQL                                                     02370099
             INCLUDE DB2CLIE                                            02380099
           END-EXEC.                                                    02390099
                                                                        02400099
      * DECLARAMOS EL CURSOR                                            02410099
                                                                        02420099
           EXEC SQL                                                     02430099
             DECLARE ITEM_CURSOR CURSOR                                 02440099
             FOR                                                        02450099
             SELECT  TIPCUEN, NROCUEN,SUCUEN,NROCLI, SALDO,FECSAL       02460099
                                                                        02490099
               FROM  ITPLZRY.TB99CUEN                                   02500099
                     WHERE NROCLI = 125                                 02510099
              ORDER  BY SUCUEN ASC,                                     02520099
                        NROCLI ASC,                                     02530099
                        NROCUEN ASC                                     02540099
           END-EXEC.                                                    02550099
                                                                        02560099
      ***************************************************************.  02561099
                                                                        02570099
       PROCEDURE DIVISION.                                              02571099
                                                                        02580099
      **************************************                            02610099
      *                                    *                            02620099
      *  CUERPO PRINCIPAL DEL PROGRAMA     *                            02630099
      *                                    *                            02640099
      **************************************                            02650099
       MAIN-PROGRAM.                                                    02660099
                                                                        02670099
           PERFORM  1000-I-INICIO                                       02680099
              THRU  1000-F-INICIO.                                      02690099
                                                                        02700099
           PERFORM  3000-I-PROCESO                                      02710099
              THRU  3000-F-PROCESO                                      02720099
             UNTIL  WS-FIN-PROCESO.                                     02730099
                                                                        02740099
           PERFORM  8000-I-ULTIMO-REGISTRO                              02750099
              THRU  8000-F-ULTIMO-REGISTRO.                             02760099
                                                                        02770099
           PERFORM  9999-I-FINAL                                        02780099
              THRU  9999-F-FINAL.                                       02790099
                                                                        02800099
       F-MAIN-PROGRAM. GOBACK.                                          02810099
                                                                        02820099
      *************************************************************     02871099
                                                                        02872099
       1000-I-INICIO.                                                   02880099
                                                                        02881099
           ADD    1                   TO   WS-CANT-CTAS-TOT.            02900099
                                                                        02901099
      * PREPARAMOS FECHA PARA TITULO 1                                  02910099
                                                                        02920099
           SET    WS-NO-FIN-PROCESO   TO   TRUE.                        02930099
           ACCEPT WS-FECHA            FROM DATE YYYYMMDD                02940099
           MOVE   WS-DIA              TO   WS-IMPR-DIA                  02950099
           MOVE   WS-MES              TO   WS-IMPR-MES                  02960099
           MOVE   WS-ANIO             TO   WS-IMPR-ANIO                 02970099
           MOVE   62                  TO   WS-CUENTA-LINEA              02980099
                                                                        02990099
      * TRAEMOS DATOS DE CLIENTE PARA EL TITULO 2                       03000099
                                                                        03010099
           PERFORM 1500-TRAER-CLIENTE THRU 1500-F-TRAER-CLIENTE.        03020099
                                                                        03030099
      * OPEN OUTPUT PRINT                                               03040099
                                                                        03050099
           OPEN OUTPUT IMPRIMIR                                         03060099
           IF WS-IMPR-CODE            IS NOT EQUAL '00'                 03070099
               DISPLAY '* ERROR DE OPEN IMPRIMIR = ' WS-IMPR-CODE       03080099
               MOVE 9999              TO RETURN-CODE                    03090099
               SET  WS-FIN-PROCESO    TO TRUE                           03100099
           END-IF.                                                      03110099
                                                                        03120000
      * OPEN CURSOR                                                     03130099
                                                                        03140099
           EXEC SQL                                                     03150099
              OPEN ITEM_CURSOR                                          03160099
           END-EXEC.                                                    03170099
                                                                        03180099
           IF SQLCODE                 NOT EQUAL ZEROS                   03190099
               MOVE SQLCODE           TO WS-SQLCODE                     03200099
               DISPLAY '* ERROR EN OPEN CURSOR = ' WS-SQLCODE           03210099
               SET  WS-FIN-PROCESO    TO TRUE                           03220099
           END-IF.                                                      03230099
                                                                        03240099
                                                                        03250099
      * PRIMER FETCH CURSOR                                             03260099
                                                                        03270099
           EXEC SQL                                                     03280099
               FETCH ITEM_CURSOR                                        03290099
                   INTO                                                 03300099
                       :WS-CUEN.WS-TIPCUEN,                             03310099
                       :WS-CUEN.WS-NROCUEN,                             03320099
                       :WS-CUEN.WS-SUCUEN,                              03330099
                       :WS-CUEN.WS-NROCLI,                              03340099
                       :WS-CUEN.WS-SALDO,                               03350099
                       :WS-CUEN.WS-FECSAL                               03360099
           END-EXEC.                                                    03370099
                                                                        03380099
      * CONTROL DE SQLCODE Y LOGICA DE PRIMERA LECTURA DE CORTE CONTR   03390099
           EVALUATE TRUE                                                03400099
                                                                        03410099
               WHEN SQLCODE           EQUAL ZEROES                      03420099
                   MOVE WS-SUCUEN     TO WS-SUC-ANT                     03440099
                   MOVE WS-TIPCUEN    TO WS-TIPCUEN-ANT                 03450099
                   ADD 1              TO WS-SUB-SUCUEN                  03460099
                   ADD 1              TO WS-SUB-TIPCUEN                 03470099
                   ADD WS-SALDO       TO WS-SUB-SALDO-SUC               03480099
                   ADD WS-SALDO       TO WS-SUB-SALDO-TIPC              03490099
                   ADD WS-SALDO       TO WS-SUB-SALDO-TOTAL             03500099
      * PRINT                                                           03510099
                   PERFORM 2000-I-IMPRIMIR-TITULOS                      03530099
                      THRU 2000-F-IMPRIMIR-TITULOS                      03540099
                                                                        03550099
               WHEN SQLCODE            EQUAL +100                       03560099
                   DISPLAY 'PRIMER LECTURA SQLCODE > 100'               03570099
                   SET  WS-FIN-PROCESO TO TRUE                          03580099
                                                                        03590099
               WHEN OTHER                                               03600099
                   MOVE SQLCODE        TO WS-SQLCODE                    03610099
                   DISPLAY '* ERROR DE FETCH CURSOR = ' WS-SQLCODE      03620099
                   SET  WS-FIN-PROCESO TO TRUE                          03630099
                   MOVE 9999           TO RETURN-CODE                   03640099
           END-EVALUATE.                                                03650099
      *    DISPLAY 'IMPRIMO SUBTITULO DESDE INICIO.'.                   03660099
           PERFORM 2400-I-IMP-SUBT                                      03670099
              THRU 2400-F-IMP-SUBT.                                     03680099
                                                                        03690099
       1000-F-INICIO.   EXIT.                                           03700048
                                                                        03710048
       1500-TRAER-CLIENTE.                                              03711099
                                                                        03712099
           EXEC SQL                                                     03713099
             SELECT TIPDOC, NRODOC, NOMAPE                              03714099
                                                                        03715099
               INTO :WS-CLIE.WS-TIPDOC,                                 03716099
                    :WS-CLIE.WS-NRODOC,                                 03717099
                    :WS-CLIE.WS-NOMAPE                                  03718099
                                                                        03719099
               FROM ITPLZRY.TB99CLIE                                    03719199
              WHERE NROCLI = 125                                        03719299
                                                                        03719399
              FETCH FIRST 1 ROW ONLY                                    03719499
           END-EXEC.                                                    03719599
                                                                        03719699
           MOVE SQLCODE                TO WS-SQLCODE.                   03719799
                                                                        03719899
           EVALUATE TRUE                                                03719999
               WHEN SQLCODE            EQUAL SQL-NOT-FOUND              03720099
                DISPLAY 'CLIENTE NO EXISTE. FINALIZO EL PROGRAMA'       03720199
                SET  WS-FIN-PROCESO    TO TRUE                          03720299
                                                                        03720399
               WHEN SQLCODE            EQUAL ZEROES                     03720499
                 MOVE WS-TIPDOC OF WS-CLIE   TO WS-LIS-TIPDOC           03720599
                 MOVE WS-NRODOC OF WS-CLIE   TO WS-LIS-NRODOC           03720699
                 MOVE WS-NOMAPE OF WS-CLIE   TO WS-LIS-NOMAPE           03720799
                 MOVE 125                    TO WS-LIS-NROCLI           03720899
                                                                        03720999
               WHEN OTHER                                               03721099
                   DISPLAY '* ERROR DE VERIFICACION DB2 = ' WS-SQLCODE  03721199
                   MOVE 9999          TO RETURN-CODE                    03721299
                   SET WS-FIN-PROCESO TO TRUE                           03721399
                                                                        03721499
           END-EVALUATE.                                                03721599
                                                                        03721699
       1500-F-TRAER-CLIENTE. EXIT.                                      03721799
                                                                        03721899
       2000-I-IMPRIMIR-TITULOS.                                         03721999
                                                                        03722199
           MOVE 2                      TO WS-CUENTA-LINEA               03722299
                                                                        03722399
      ** IMPRIMO TITULO 1                                               03722499
                                                                        03722599
           WRITE REG-IMPRIMIR FROM WS-IMPR-TITULO  AFTER PAGE           03722699
           IF WS-IMPR-CODE    IS NOT EQUAL '00'                         03722799
               DISPLAY '* ERROR DE WRITE TITULO IMPRIMIR = '            03722899
                                                WS-IMPR-CODE            03722999
               MOVE 9999               TO RETURN-CODE                   03723099
               SET  WS-FIN-PROCESO     TO TRUE                          03723199
           END-IF.                                                      03723299
                                                                        03723399
      * IMPRIMO TITULO 2 . DATOS DEL CLIENTE                            03723499
                                                                        03723599
           WRITE REG-IMPRIMIR FROM WS-IMPR-TITULO2  AFTER 1             03723699
           IF WS-IMPR-CODE IS NOT EQUAL '00'                            03723799
               DISPLAY '* ERROR DE WRITE TITULO IMPRIMIR = '            03723899
                                                WS-IMPR-CODE            03723999
               MOVE 9999               TO RETURN-CODE                   03724099
               SET  WS-FIN-PROCESO     TO TRUE                          03724199
           END-IF.                                                      03724299
                                                                        03724399
      * IMPRIMO EL REGISTRO DEL TITULO 2. DATOS CLINETE                 03724499
                                                                        03724599
           MOVE WS-LIS-REGISTRO-CLIENTE TO WS-LINEA-IMPRESION.          03724699
                                                                        03724799
           PERFORM 2800-I-IMPR-LINEA    THRU 2800-F-IMPR-LINEA.         03724899
                                                                        03724999
       2000-F-IMPRIMIR-TITULOS. EXIT.                                   03725099
                                                                        03726099
       2400-I-IMP-SUBT.                                                 03727699
      * IMPRIMO SUBTITULO                                               03727799
                                                                        03727899
           WRITE REG-IMPRIMIR FROM WS-IMPR-SUBTITULO AFTER 1            03727999
           IF WS-IMPR-CODE IS NOT EQUAL '00'                            03728099
               DISPLAY '* ERROR DE WRITE SUBTITULO IMPRIMIR = '         03728199
                                                   WS-IMPR-CODE         03728299
               MOVE 9999               TO RETURN-CODE                   03728399
               SET  WS-FIN-PROCESO     TO TRUE                          03728499
           END-IF.                                                      03728599
                                                                        03728699
           MOVE WS-TIPCUEN OF WS-CUEN  TO WS-IMPR-TIPCUEN               03729299
           MOVE WS-NROCUEN OF WS-CUEN  TO WS-IMPR-NROCUEN               03729399
           MOVE WS-SUCUEN  OF WS-CUEN  TO WS-IMPR-SUCUEN                03729499
           MOVE WS-SALDO   OF WS-CUEN  TO WS-IMPR-SALDO                 03729599
           MOVE WS-FECSAL  OF WS-CUEN  TO WS-IMPR-FECSAL                03729699
                                                                        03729799
           MOVE WS-REG-CUENTA          TO WS-LINEA-IMPRESION.           03729899
                                                                        03729999
           PERFORM 2800-I-IMPR-LINEA   THRU 2800-F-IMPR-LINEA.          03730099
                                                                        03730199
       2400-F-IMP-SUBT. EXIT.                                           03730299
                                                                        03730399
                                                                        03730499
       2800-I-IMPR-LINEA.                                               03730599
                                                                        03730699
           IF WS-CUENTA-LINEA GREATER THAN 60 THEN                      03730899
               PERFORM 2000-I-IMPRIMIR-TITULOS                          03730999
                  THRU 2000-F-IMPRIMIR-TITULOS                          03731099
           END-IF                                                       03731199
                                                                        03731299
           WRITE REG-IMPRIMIR FROM WS-LINEA-IMPRESION AFTER 1           03731399
           EVALUATE WS-IMPR-CODE                                        03731499
               WHEN '00'                                                03731599
                   CONTINUE                                             03731699
               WHEN OTHER                                               03731799
                                                                        03731899
                   DISPLAY '* ERROR DE WRITE LINEA IMPRESION = '        03731999
                                                   WS-IMPR-CODE         03732099
                   SET WS-FIN-PROCESO  TO TRUE                          03732199
                   MOVE 9999           TO RETURN-CODE                   03732299
           END-EVALUATE.                                                03732399
                                                                        03732499
           ADD 1                       TO WS-CUENTA-LINEA.              03732599
           INITIALIZE WS-LINEA-IMPRESION.                               03732699
                                                                        03732799
       2800-F-IMPR-LINEA. EXIT.                                         03732899
                                                                        03732999
                                                                        03733099
       3000-I-PROCESO.                                                  03734099
                                                                        03740099
      *    DISPLAY 'ENTRO A 3000-I-PROCESO'.                            03750099
      *    ADD 1 TO WS-CANT-CTAS-TOT.                                   03760099
           EXEC SQL                                                     03770099
              FETCH  ITEM_CURSOR                                        03780099
                     INTO                                               03790099
                        :WS-CUEN.WS-TIPCUEN,                            03800099
                        :WS-CUEN.WS-NROCUEN,                            03810099
                        :WS-CUEN.WS-SUCUEN,                             03820099
                        :WS-CUEN.WS-NROCLI,                             03830099
                        :WS-CUEN.WS-SALDO,                              03840099
                        :WS-CUEN.WS-FECSAL                              03850099
           END-EXEC.                                                    03860099
                                                                        03870099
           EVALUATE TRUE                                                03880099
                                                                        03890099
               WHEN SQLCODE EQUAL ZEROES                                03900099
                                                                        03920099
      ** CUENTAS TOTALES PARA EL FINAL:                                 03930099
                ADD 1                  TO WS-CANT-CTAS-TOT              03940099
      ** SALDOS TOTALES PARA EL FINAL:                                  03950099
                ADD WS-SALDO           TO WS-SUB-SALDO-TOTAL            03960099
                                                                        03970099
      * COMPARAMOS CON REGISTRO ANTERIOR PARA LA LOGICA DE LOS CORTES   03980099
                                                                        03990099
                IF WS-SUCUEN = WS-SUC-ANT       THEN                    04000099
                 IF WS-TIPCUEN = WS-TIPCUEN-ANT THEN                    04010099
                  PERFORM 3500-I-SEGUIR-PROCESO                         04020099
                   THRU 3500-F-SEGUIR-PROCESO                           04030099
                 ELSE                                                   04040099
                  PERFORM 5000-I-CORTE-TIPCUEN                          04050099
                   THRU 5000-F-CORTE-TIPCUEN                            04060099
                 END-IF                                                 04070099
                ELSE                                                    04080099
                 PERFORM 4000-I-CORTE-SUCURSAL                          04090099
                  THRU 4000-F-CORTE-SUCURSAL                            04100099
                END-IF                                                  04110099
                                                                        04120099
               WHEN SQLCODE EQUAL +100                                  04130099
               SET WS-FIN-PROCESO  TO TRUE                              04150099
                                                                        04160099
               WHEN OTHER                                               04170099
                   MOVE SQLCODE        TO WS-SQLCODE                    04180099
                   DISPLAY 'ERROR FETCH CURSOR = ' WS-SQLCODE           04190099
                   SET WS-FIN-PROCESO  TO TRUE                          04200099
           END-EVALUATE.                                                04210099
                                                                        04220099
       3000-F-PROCESO. EXIT.                                            04230099
                                                                        04240099
      *************************NUEVOSPERFORMS!**********************    04250099
                                                                        04260099
       3500-I-SEGUIR-PROCESO.                                           04270099
                                                                        04280099
      ** PRIMERO IMPRIMO SUBTITULOS                                     04290099
           PERFORM 2400-I-IMP-SUBT                                      04300099
           THRU 2400-F-IMP-SUBT.                                        04310099
           ADD 1                            TO WS-SUB-SUCUEN.           04320099
           ADD 1                            TO WS-SUB-TIPCUEN.          04330099
           ADD WS-SALDO                     TO WS-SUB-SALDO-SUC.        04340099
           ADD WS-SALDO                     TO WS-SUB-SALDO-TIPC.       04350099
                                                                        04360099
       3500-F-SEGUIR-PROCESO. EXIT.                                     04370099
                                                                        04380099
       4000-I-CORTE-SUCURSAL.                                           04390099
                                                                        04400099
      *  PRIMERO ASEGURARME DE QUE NO HAYA TAMBIEN UN CORTE POR TIPC    04410099
                                                                        04420099
           IF WS-TIPCUEN NOT = WS-TIPCUEN-ANT                           04430099
                                                                        04440099
            PERFORM 5500-I-PRINT-CORTE-C-TIP                            04450099
            THRU 5500-F-PRINT-CORTE-C-TIP                               04460099
                                                                        04470099
            MOVE 0                          TO WS-SUB-TIPCUEN           04480099
            MOVE 0                          TO WS-SUB-SALDO-TIPC        04490099
            MOVE WS-TIPCUEN                 TO WS-TIPCUEN-ANT           04500099
                                                                        04520099
           END-IF.                                                      04530099
                                                                        04540099
      *              IMPRESION DE CORTE DE CONTROL SUC                  04550099
                                                                        04560099
           PERFORM 4500-I-PRINT-CORTE-C-SUC                             04570099
           THRU    4500-F-PRINT-CORTE-C-SUC.                            04580099
                                                                        04590099
      *                IMPRIMO SUBTITULOS                               04600099
           PERFORM 2400-I-IMP-SUBT                                      04610099
           THRU 2400-F-IMP-SUBT.                                        04620099
                                                                        04630099
      *               MOVEMOS VARIABLES NECESARIAS                      04640099
                                                                        04650099
           MOVE WS-SUCUEN                   TO WS-SUC-ANT.              04660099
           MOVE 1                           TO WS-SUB-SUCUEN.           04670099
           ADD  1                           TO WS-SUB-TIPCUEN.          04680099
           MOVE WS-SALDO                    TO WS-SUB-SALDO-SUC.        04690099
           ADD  WS-SALDO                    TO WS-SUB-SALDO-TIPC.       04700099
                                                                        04710099
       4000-F-CORTE-SUCURSAL. EXIT.                                     04720099
                                                                        04730099
       4500-I-PRINT-CORTE-C-SUC.                                        04740099
                                                                        04750099
           MOVE WS-SUB-SUCUEN               TO WS-IMPR-CANT-CUENXSUC.   04760099
           MOVE WS-SUB-SALDO-SUC            TO WS-IMPR-SALDOS-S.        04770099
           MOVE WS-SUC-ANT                  TO WS-IMPR-SUCUEN-SUB.      04780099
      *                          IMPRIMIR                               04790099
           MOVE WS-IMPR-SUBTOTALES-SUCURSAL TO WS-LINEA-IMPRESION.      04800099
           PERFORM 2800-I-IMPR-LINEA                                    04810099
              THRU 2800-F-IMPR-LINEA.                                   04820099
                                                                        04830099
       4500-F-PRINT-CORTE-C-SUC. EXIT.                                  04840099
                                                                        04850099
       5000-I-CORTE-TIPCUEN.                                            04860099
                                                                        04870099
      *          IMPRIMO CORTE DE CONTROL POR TIPCUEN                   04880099
                                                                        04890099
           PERFORM 5500-I-PRINT-CORTE-C-TIP                             04900099
           THRU 5500-F-PRINT-CORTE-C-TIP.                               04910099
                                                                        04920099
      *                IMPRIMO SUBTITULOS                               04930099
           PERFORM 2400-I-IMP-SUBT                                      04940099
           THRU 2400-F-IMP-SUBT.                                        04950099
                                                                        04960099
      *               MOVEMOS VARIABLES NECESARIAS                      04970099
                                                                        04980099
           MOVE WS-TIPCUEN                  TO WS-TIPCUEN-ANT.          04990099
           ADD  1                           TO WS-SUB-SUCUEN.           05000099
           MOVE 1                           TO WS-SUB-TIPCUEN.          05010099
           ADD  WS-SALDO                    TO WS-SUB-SALDO-SUC.        05020099
           MOVE WS-SALDO                    TO WS-SUB-SALDO-TIPC.       05030099
                                                                        05040099
                                                                        05050099
                                                                        05060099
       5000-F-CORTE-TIPCUEN. EXIT.                                      05070099
                                                                        05080099
       5500-I-PRINT-CORTE-C-TIP.                                        05090099
                                                                        05100099
      *           IMPRESION DE CORTE DE CONTROL TIPCUEN                 05110099
                                                                        05120099
           IF WS-TIPCUEN-ANT                EQUAL 1                     05130099
            MOVE 'CAJA DE AHORROS: '        TO WS-IMPR-TIPCUEN-SB       05140099
           END-IF.                                                      05150099
                                                                        05160099
           IF WS-TIPCUEN-ANT                EQUAL 2                     05170099
            MOVE 'CUENTAS CORRIENTES: '     TO WS-IMPR-TIPCUEN-SB       05180099
           END-IF.                                                      05190099
                                                                        05200099
           IF WS-TIPCUEN-ANT                EQUAL 3                     05210099
            MOVE 'PLAZO FIJO: '             TO WS-IMPR-TIPCUEN-SB       05220099
           END-IF.                                                      05230099
                                                                        05240099
           MOVE WS-SUB-SALDO-TIPC           TO WS-IMPR-SALDOS-T.        05250099
           MOVE WS-SUB-TIPCUEN              TO WS-IMPR-CANT-TIPCUEN.    05260099
      *                           IMPRIMIR                              05270099
           MOVE WS-IMPR-SUBTOTALES-TIPCUEN  TO WS-LINEA-IMPRESION.      05280099
           PERFORM 2800-I-IMPR-LINEA                                    05290099
              THRU 2800-F-IMPR-LINEA.                                   05300099
                                                                        05310099
       5500-F-PRINT-CORTE-C-TIP. EXIT.                                  05320099
                                                                        05330099
       8000-I-ULTIMO-REGISTRO.                                          06560099
                                                                        06570099
           PERFORM 4500-I-PRINT-CORTE-C-SUC                             06580099
           THRU    4500-F-PRINT-CORTE-C-SUC.                            06590099
                                                                        06600099
           PERFORM 5500-I-PRINT-CORTE-C-TIP                             06610099
           THRU 5500-F-PRINT-CORTE-C-TIP.                               06620099
                                                                        06630099
                                                                        06640099
       8000-F-ULTIMO-REGISTRO. EXIT.                                    06650099
                                                                        06660099
                                                                        06670099
       9999-I-FINAL.                                                    06680099
      * IMPRIMIR TOTALES                                                06700099
           MOVE WS-SUB-SALDO-TOTAL          TO  WS-IMPR-SALDOS-G.       06710099
           MOVE WS-CANT-CTAS-TOT            TO WS-IMPR-CANT-CUENXBCO.   06720099
           MOVE WS-IMPR-TOTALES-GENERALES   TO WS-LINEA-IMPRESION.      06730099
           PERFORM 2800-I-IMPR-LINEA                                    06750099
              THRU 2800-F-IMPR-LINEA.                                   06760099
                                                                        06770099
      * CLOSE CURSOSR                                                   06780099
           EXEC SQL                                                     06790099
              CLOSE ITEM_CURSOR                                         06800099
           END-EXEC.                                                    06810099
                                                                        06820099
           IF SQLCODE NOT EQUAL ZEROS                                   06830099
               MOVE SQLCODE            TO WS-SQLCODE                    06840099
               DISPLAY '* ERROR EN CLOSE CURSOR = ' WS-SQLCODE          06850099
               MOVE 9999               TO RETURN-CODE                   06860099
           END-IF.                                                      06870099
                                                                        06880099
      * CLOSE OUTPUT (IMPRIMIR)                                         06890099
           CLOSE IMPRIMIR                                               06900099
           IF WS-IMPR-CODE IS NOT EQUAL '00' THEN                       06910099
               DISPLAY '* ERROR DE CLOSE IMPRIMIR = ' WS-IMPR-CODE      06920099
               MOVE 9999               TO RETURN-CODE                   06930099
           END-IF.                                                      06940099
                                                                        06950099
       9999-F-FINAL. EXIT.                                              06960099
                                                                        06970099
